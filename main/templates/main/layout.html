{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Open Cult is a ridiculously minimal event system for groups.">
    <meta name="google-site-verification" content="rm5lxRnogBhCtPQQ3juuxbGg8OZZ51TvtqhEeJGyyyQ">
    <title>{% block title %}Open Cult{% endblock %}</title>
    <link rel="stylesheet" href="{% static '/main/styles/main.css' %}">
</head>
<body>
    <header>
        <a href="{% url 'main:index' %}" class="header-brand">Open Cult</a>
        <nav>
            <a href="{% url 'main:new_group' %}">new group</a>
            {% if request.user.is_authenticated %}
                | <a href="{% url 'main:profile' request.user.username %}">my groups</a>
            {% endif %}
            {% if nav_show_own_groups %}
                {% for group in own_groups %}
                    | <a href="{% url 'main:group' group.slug %}">{{ group.name }}</a>
                {% endfor %}
            {% endif %}
            {% if nav_show_group %}
                | <a href="{% url 'main:group' group.slug %}">{{ group.name }}</a>
            {% endif %}
            {% if nav_show_organizer_add and request.user in group.organizers_list %}
                | <a href="{% url 'main:group_organizer' group.slug %}">add group organizer</a>
            {% endif %}
            {% if nav_show_edit_group and request.user in group.organizers_list %}
                | <a href="{% url 'main:edit_group' group.slug %}">edit group</a>
            {% endif %}
            {% if nav_show_new_event and request.user in group.organizers_list %}
                | <a href="{% url 'main:new_event' group.slug %}">new event</a>
            {% endif %}
            {% if nav_show_group_announcement and request.user in group.organizers_list %}
                | <a href="{% url 'main:group_announcement' group.slug %}">email members</a>
            {% endif %}
            {% if nav_show_edit_event and request.user in event.group.organizers_list %}
                | <a href="{% url 'main:edit_event' event.group.slug event.slug %}">edit event</a>
            {% endif %}
            {% if nav_show_logout %}
                | <a href="{% url 'main:logout' %}">logout</a>
            {% endif %}
            {% if nav_show_join_group %}
                {% if request.user not in group.organizers_list or group.organizers_count != 1 %}
                    {% if membership %}
                        <form action="{% url 'main:delete_membership' group.slug %}" method="post" class="inline">
                            {% csrf_token %}
                            | <input type="submit" value="leave group">
                        </form>
                    {% else %}
                        <form action="{% url 'main:membership' group.slug %}" method="post" class="inline">
                            {% csrf_token %}
                            | <input type="submit" value="join">
                        </form>
                    {% endif %}
                {% endif %}
            {% endif %}
            {% if nav_show_rsvp_event and event.date >= now.date %}
                {% if attendance %}
                    <form action="{% url 'main:delete_attendance' event.group.slug event.slug %}" method="post" class="inline">
                        {% csrf_token %}
                        | <input type="submit" value="un-rsvp">
                    </form>
                {% else %}
                    <form action="{% url 'main:attendance' event.group.slug event.slug %}" method="post" class="inline">
                        {% csrf_token %}
                        | <input type="submit" value="rsvp">
                    </form>
                {% endif %}
            {% endif %}
            {% if messages %}
                | <span class="alert">
                    {% for message in messages %}
                        {{ message }}
                    {% endfor %}
                </span>
            {% endif %}
        </nav>
        {% if request.user.is_authenticated %}
        <a href="{% url 'main:edit_profile' request.user.username %}" class="header-user">{{ request.user.username }}</a>
        {% else %}
        <a href="{% url 'main:login' %}" class="header-user">login</a>
        {% endif %}
    </header>

    {% block content %}
    {% endblock %}

    <footer>
        <a href="{% url 'main:about' %}">About</a>
        | <a href="{% url 'api:docs' %}">API</a>
        | <a href="mailto:hi@opencult.com">Contact</a>
    </footer>

    {% if ld_group %}
    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [{
                "@type": "ListItem",
                "position": 1,
                "item": {
                    "@id": "https://opencult.com/{{ group.slug }}",
                    "name": "{{ group.name }}"
                }
            }]
        }
    </script>
    {% endif %}

    {% if ld_event %}
    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [{
                "@type": "ListItem",
                "position": 1,
                "item": {
                    "@id": "https://opencult.com/{{ event.group.slug }}",
                    "name": "{{ event.group.name }}"
                }
            },{
                "@type": "ListItem",
                "position": 2,
                "item": {
                    "@id": "https://opencult.com/{{ event.group.slug }}/{{ event.slug }}",
                    "name": "{{ event.title }}"
                }
            }]
        }
    </script>
    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Event",
            "name": "{{ event.title }}",
            "startDate": "{{ event.date|date:"Y-m-d" }}T{{ event.time|time:"H:i" }}",
            "location": "{{ event.venue }} {{ event.address }}",{% if event.details %},
            "description": "{{ event.details }}"{% endif %}
        }
    </script>
    {% endif %}
</body>
</html>
